<!-- file-preview.component.html -->
<div class="preview-container">
  <!-- Unified Preview Modal -->
  <div *ngIf="activePreview$ | async as preview" class="preview-header">
    {{ preview | json }}
     
    <div class="preview-content">
      <!-- Image Preview -->
      <img *ngIf="preview.type === 'image'" 
           [src]="preview.url" 
           [alt]="preview.fileName"
           class="preview-image"
           (load)="onContentLoaded()">

        <!-- PDF and Office Documents (combined iframe handling) -->
        <iframe *ngIf="preview.type === 'pdf' || preview.type === 'office'"
        [src]="preview.url"
        (loadeddata)="onContentLoaded()"
        [title]="preview.fileName + ' preview'"
        class="preview-iframe"
        frameborder="0"></iframe>
              
       <!-- Video Preview -->
    <video *ngIf="preview.type === 'video'"
           [controls]="preview.showControls ?? true"
           [autoplay]="preview.autoplay ?? false"
           [poster]="preview.posterUrl"
           class="preview-video"
           (loadeddata)="onContentLoaded()">
      <source [src]="preview.url" 
              [type]="preview.fileType">
    </video>
    
    <!-- Audio Preview -->
    <audio *ngIf="preview.type === 'audio'"
           [controls]="preview.showControls ?? true"
           [autoplay]="preview.autoplay ?? false"
           class="preview-audio"
           (loadeddata)="onContentLoaded()">
      <source [src]="preview.url" 
              [type]="preview.fileType">
    </audio>
    
    <!-- Text/Code Preview -->
    <div *ngIf="preview.type === 'code'" class="code-preview-container">
      <div class="code-toolbar">
        <button mat-icon-button (click)="copyCodeContent(preview.content || '')" 
                matTooltip="Copy to clipboard">
          <mat-icon>content_copy</mat-icon>
        </button>
      </div>
      
      <ng-container *ngIf="!isLoading; else loading">
      <pre *ngIf="preview.content" class="code-content">
        <code [class]="'language-' + (preview.language || 'text')">
          {{ preview.content }}
        </code>
      </pre>

      <iframe *ngIf="!preview.content"
            [src]="preview.url"
            class="code-iframe"
            (load)="onContentLoaded()"
            title="Code file preview"></iframe>
      </ng-container>
      <ng-template #loading>
        <div class="loading-spinner">
          <mat-spinner diameter="50"></mat-spinner>
        </div>
      </ng-template>
      <!-- Loading Indicator -->
      <!-- <div *ngIf="isLoading" class="loading-spinner">
        <mat-spinner diameter="50"></mat-spinner>
      </div> -->
    </div>
  </div>
</div>